import math

NEXRAD_STATIONS = [
    {"id": "KABR", "lat": 45.455, "lon": -98.413},
    {"id": "KABX", "lat": 35.150, "lon": -106.823},
    {"id": "KAKQ", "lat": 36.983, "lon": -77.007},
    {"id": "KAMA", "lat": 35.233, "lon": -101.708},
    {"id": "KAMX", "lat": 25.611, "lon": -80.413},
    {"id": "KAPX", "lat": 44.906, "lon": -84.719},
    {"id": "KARX", "lat": 43.822, "lon": -91.191},
    {"id": "KATX", "lat": 48.194, "lon": -122.494},
    {"id": "KBBX", "lat": 39.496, "lon": -121.631},
    {"id": "KBGM", "lat": 42.199, "lon": -75.985},
    {"id": "KBHX", "lat": 40.498, "lon": -124.290},
    {"id": "KBIS", "lat": 46.770, "lon": -100.758},
    {"id": "KBLX", "lat": 45.853, "lon": -108.605},
    {"id": "KBMX", "lat": 33.171, "lon": -86.769},
    {"id": "KBOX", "lat": 42.204, "lon": -71.755},
    {"id": "KBRO", "lat": 25.915, "lon": -97.419},
    {"id": "KBUF", "lat": 42.948, "lon": -78.736},
    {"id": "KBYX", "lat": 24.597, "lon": -81.703},
    {"id": "KCAE", "lat": 33.948, "lon": -81.119},
    {"id": "KCBW", "lat": 46.029, "lon": -67.806},
    {"id": "KCBX", "lat": 44.742, "lon": -85.294},
    {"id": "KCCX", "lat": 40.923, "lon": -78.003},
    {"id": "KCLE", "lat": 41.412, "lon": -81.859},
    {"id": "KCLX", "lat": 32.655, "lon": -81.042},
    {"id": "KCRP", "lat": 27.784, "lon": -97.511},
    {"id": "KCXX", "lat": 44.511, "lon": -73.166},
    {"id": "KDAX", "lat": 38.502, "lon": -121.676},
    {"id": "KDFX", "lat": 29.269, "lon": -100.279},
    {"id": "KDGX", "lat": 32.289, "lon": -89.984},
    {"id": "KDLH", "lat": 46.836, "lon": -92.209},
    {"id": "KDMX", "lat": 41.731, "lon": -93.723},
    {"id": "KDOX", "lat": 38.825, "lon": -75.439},
    {"id": "KDTX", "lat": 42.700, "lon": -83.471},
    {"id": "KDVN", "lat": 41.611, "lon": -90.580},
    {"id": "KEAX", "lat": 38.810, "lon": -94.264},
    {"id": "KEMX", "lat": 31.893, "lon": -110.630},
    {"id": "KENX", "lat": 42.586, "lon": -74.064},
    {"id": "KEOX", "lat": 31.460, "lon": -85.459},
    {"id": "KEPZ", "lat": 31.873, "lon": -106.698},
    {"id": "KESX", "lat": 35.701, "lon": -114.891},
    {"id": "KEVX", "lat": 30.563, "lon": -85.922},
    {"id": "KEWX", "lat": 29.703, "lon": -98.026},
    {"id": "KEYX", "lat": 35.097, "lon": -117.561},
    {"id": "KFCX", "lat": 37.024, "lon": -80.274},
    {"id": "KFDR", "lat": 34.362, "lon": -98.976},
    {"id": "KFDX", "lat": 34.635, "lon": -99.273},
    {"id": "KFFC", "lat": 33.363, "lon": -84.565},
    {"id": "KFSD", "lat": 43.587, "lon": -96.728},
    {"id": "KFSX", "lat": 34.574, "lon": -111.198},
    {"id": "KFTG", "lat": 39.786, "lon": -104.545},
    {"id": "KGGW", "lat": 48.212, "lon": -106.621},
    {"id": "KGJX", "lat": 39.063, "lon": -108.214},
    {"id": "KGLD", "lat": 39.366, "lon": -101.699},
    {"id": "KGRB", "lat": 44.498, "lon": -88.111},
    {"id": "KGRK", "lat": 30.721, "lon": -97.383},
    {"id": "KGRR", "lat": 42.893, "lon": -85.544},
    {"id": "KGSP", "lat": 34.883, "lon": -82.220},
    {"id": "KGWX", "lat": 34.289, "lon": -88.992},
    {"id": "KGYX", "lat": 43.891, "lon": -70.254},
    {"id": "KHDX", "lat": 34.839, "lon": -98.442},
    {"id": "KHGX", "lat": 29.471, "lon": -95.078},
    {"id": "KHNX", "lat": 36.314, "lon": -119.631},
    {"id": "KHPX", "lat": 36.741, "lon": -87.288},
    {"id": "KHTX", "lat": 34.930, "lon": -86.084},
    {"id": "KICT", "lat": 37.654, "lon": -97.443},
    {"id": "KICX", "lat": 37.590, "lon": -112.863},
    {"id": "KILN", "lat": 39.420, "lon": -83.822},
    {"id": "KILX", "lat": 40.151, "lon": -89.337},
    {"id": "KIND", "lat": 39.707, "lon": -86.280},
    {"id": "KINX", "lat": 36.175, "lon": -95.564},
    {"id": "KIWA", "lat": 33.289, "lon": -111.671},
    {"id": "KIWX", "lat": 41.363, "lon": -85.700},
    {"id": "KJAX", "lat": 30.484, "lon": -81.701},
    {"id": "KJGX", "lat": 32.675, "lon": -83.351},
    {"id": "KJKL", "lat": 37.590, "lon": -83.313},
    {"id": "KLBB", "lat": 33.654, "lon": -101.814},
    {"id": "KLCH", "lat": 30.125, "lon": -93.215},
    {"id": "KLIX", "lat": 30.336, "lon": -89.825},
    {"id": "KLNX", "lat": 42.064, "lon": -100.689},
    {"id": "KLOT", "lat": 41.600, "lon": -88.083},
    {"id": "KLRX", "lat": 40.741, "lon": -116.805},
    {"id": "KLSX", "lat": 38.698, "lon": -90.682},
    {"id": "KLTX", "lat": 33.989, "lon": -78.430},
    {"id": "KLVX", "lat": 37.975, "lon": -85.943},
    {"id": "KLWX", "lat": 38.976, "lon": -77.488},
    {"id": "KLZK", "lat": 34.836, "lon": -92.254},
    {"id": "KMAF", "lat": 31.942, "lon": -102.188},
    {"id": "KMAX", "lat": 42.081, "lon": -122.718},
    {"id": "KMBX", "lat": 48.378, "lon": -100.864},
    {"id": "KMHX", "lat": 34.775, "lon": -76.876},
    {"id": "KMKX", "lat": 42.968, "lon": -88.550},
    {"id": "KMLB", "lat": 28.113, "lon": -80.654},
    {"id": "KMOB", "lat": 30.679, "lon": -88.239},
    {"id": "KMPX", "lat": 44.848, "lon": -93.561},
    {"id": "KMQT", "lat": 46.531, "lon": -87.548},
    {"id": "KMRX", "lat": 36.168, "lon": -83.401},
    {"id": "KMSX", "lat": 47.050, "lon": -113.987},
    {"id": "KMTX", "lat": 41.262, "lon": -112.446},
    {"id": "KMUX", "lat": 37.155, "lon": -121.894},
    {"id": "KMVX", "lat": 47.528, "lon": -97.325},
    {"id": "KNKX", "lat": 32.918, "lon": -117.042},
    {"id": "KNQA", "lat": 35.344, "lon": -89.873},
    {"id": "KOAX", "lat": 41.320, "lon": -96.366},
    {"id": "KOHX", "lat": 36.247, "lon": -86.560},
    {"id": "KOKX", "lat": 40.865, "lon": -72.864},
    {"id": "KOTX", "lat": 47.681, "lon": -117.627},
    {"id": "KPAH", "lat": 37.068, "lon": -88.771},
    {"id": "KPDT", "lat": 45.691, "lon": -118.852},
    {"id": "KPOE", "lat": 31.155, "lon": -92.976},
    {"id": "KPUX", "lat": 38.459, "lon": -104.181},
    {"id": "KRAX", "lat": 35.665, "lon": -78.491},
    {"id": "KRGX", "lat": 39.753, "lon": -119.461},
    {"id": "KRIW", "lat": 43.066, "lon": -108.476},
    {"id": "KRLX", "lat": 38.310, "lon": -81.723},
    {"id": "KRTX", "lat": 45.715, "lon": -122.964},
    {"id": "KSFX", "lat": 43.111, "lon": -114.390},
    {"id": "KSGF", "lat": 37.235, "lon": -93.400},
    {"id": "KSHV", "lat": 32.450, "lon": -93.833},
    {"id": "KSIW", "lat": 40.757, "lon": -81.251},
    {"id": "KSOX", "lat": 33.819, "lon": -117.635},
    {"id": "KSRX", "lat": 35.290, "lon": -94.361},
    {"id": "KTBW", "lat": 27.705, "lon": -82.401},
    {"id": "KTFX", "lat": 47.459, "lon": -111.382},
    {"id": "KTLH", "lat": 30.397, "lon": -84.328},
    {"id": "KTLX", "lat": 35.333, "lon": -97.277},
    {"id": "KTWX", "lat": 39.066, "lon": -96.263},
    {"id": "KTYX", "lat": 43.755, "lon": -75.684},
    {"id": "KUDX", "lat": 43.855, "lon": -102.757},
    {"id": "KUEX", "lat": 40.320, "lon": -97.280},
    {"id": "KVAX", "lat": 30.889, "lon": -83.001},
    {"id": "KVBX", "lat": 34.838, "lon": -120.397},
    {"id": "KVNX", "lat": 36.740, "lon": -98.128},
    {"id": "KVTX", "lat": 34.411, "lon": -119.174},
    {"id": "KVWX", "lat": 38.262, "lon": -82.401},
    {"id": "KYUX", "lat": 32.495, "lon": -114.655},
    {"id": "PHKM", "lat": 20.125, "lon": -155.777},
    {"id": "PHMO", "lat": 21.132, "lon": -157.182},
    {"id": "PHWA", "lat": 19.096, "lon": -155.571},
    {"id": "PAEC", "lat": 64.501, "lon": -165.283},
    {"id": "PAHG", "lat": 60.671, "lon": -151.317},
    {"id": "PAKC", "lat": 58.680, "lon": -156.652},
    {"id": "PAPD", "lat": 65.035, "lon": -147.499},
    {"id": "PAIH", "lat": 55.547, "lon": -133.102},
    {"id": "PABC", "lat": 70.134, "lon": -143.581},
]

def haversine(lat1, lon1, lat2, lon2):
    """Calculate distance (in km) between two lat/lon points."""
    R = 6371
    phi1 = math.radians(lat1)
    phi2 = math.radians(lat2)
    dphi = math.radians(lat2 - lat1)
    dlambda = math.radians(lon2 - lon1)

    a = math.sin(dphi / 2) ** 2 + math.cos(phi1) * math.cos(phi2) * math.sin(dlambda / 2) ** 2
    c = 2 * math.atan2(math.sqrt(a), math.sqrt(1 - a))

    return R * c

def get_nearest_station(lat, lon):
    """Return the NEXRAD station ID closest to given lat/lon."""
    closest_station = None
    min_distance = float('inf')

    for station in NEXRAD_STATIONS:
        distance = haversine(lat, lon, station["lat"], station["lon"])
        if distance < min_distance:
            min_distance = distance
            closest_station = station["id"]

    return closest_station